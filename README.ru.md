<!-- markdown-toc start - Don't edit this section. Run M-x markdown-toc-refresh-toc -->
**Содержание**

- [ВНИМАНИЕ!](#внимание)
- [Описание](#описание)
    - [Цель проекта](#цель-проекта)
    - [Необходимые условия для запуска](#необходимые-условия-для-запуска)
    - [Первые шаги](#первые-шаги)
        - [Настроить переменные в файле astra-common-x.x.x-netinst.json](#настроить-переменные-в-файле-astra-common-xxx-netinstjson)
        - [Настроить vars.yml](#настроить-varsyml)
    - [Запуск сборки машины](#запуск-сборки-машины)
        - [Сборка виртуальной машины c GUI](#сборка-виртуальной-машины-c-gui)
        - [Сборка виртуальной машины без GUI](#сборка-виртуальной-машины-без-gui)

<!-- markdown-toc end -->


# ВНИМАНИЕ!
Данный проект находится в стадии alpha!

# Описание

## Цель проекта
Проект для автоматического создания витуальных машин `vagrant` на основе `Astra Linux Common Edition` с помошью инструмента `packer`.

## Необходимые условия для запуска

- (обязательно) `packer` == 1.6.5
- (обязательно) `vagrant` => 2.2.13
- (обязательно) `ansible` => 2.10.2

## Первые шаги

### Настроить переменные в файле astra-common-x.x.x-netinst.json
Для корректной сборки проекта необходимо заменить некоторые переменные в секции `variables` данного файла:

 | Замена        | Имя поля     | Описание                                                                                      |
 |---------------|--------------|-----------------------------------------------------------------------------------------------|
 | [обязательно] | `ip_address` | ip-адрес машины на которой происходит сборка виртуальной машины.                              |
 | [опционально] | `cpus`       | Количество ядер для сборки.                                                                   |
 | [опционально] | `name`       | hostname виртуальной машины.                                                                  |
 | [опционально] | `domain`     | domain виртуальной машины.                                                                    |
 | [обязательно] | `version`    | Версия ОС - используется в нескольких местах для создания структур папок и именования файлов. |
 | [не менять  ] | `user`       | Пользователь от имени которого будет производиться преднастройка машины.                      |
 | [не менять  ] | `password`   | Пароль пользователя для настройки машины                                                      |
 | [опционально] | `size`       | Размер HDD. Выставлено значение "30000".                                                      |
 | [опционально] | `mirror`     | Сайт с которого будет скачиваться iso-образ.                                                  |
 | [обязательно] | `md5sum`     | Контрольная сумма md5 для iso-образа                                                          |

Настоятельно рекомендуется не менять значение `user` и `password` - используются принятые в сообществе значения для данных переменных. В противном случае будет необходимо дополнительно настраивать `ansible` для работы с новыми значениями данных полей.

### Настроить vars.yml
Данный файл находится в каталоге `ansible/vars`

Все переменные (целых три) дублируют переменнные `packer`.

## Запуск сборки машины

### Сборка виртуальной машины c GUI

Запуск сборки выполняется командой:

``` shell
packer build -var version=x.x.x -var type=Desktop astra-common-x.x.x-netinst.json
```

Параметр `version` не является обязательным.

Параметр `type` является обязательным и должен принимать значение `Desktop`.

Все значения `x.x.x` необходимо заменить реальными значениями. А так же проверить что в папке `http` существует файл вида `astra-orel-x.x.x-Desktop.cfg`

По окончании сборки в терминале должно появиться сообщение следующего вида

``` shell
Build 'astra-orel' finished after 1 hour 50 minutes.

==> Wait completed after 1 hour 50 minutes

==> Builds finished. The artifacts of successful builds are:
--> astra-orel: 'libvirt' provider box: boxes/astra-orel/libvirt/x.x.x/astra-orel-x.x.x.box
```

### Сборка виртуальной машины без GUI

!! Раздел в разработке
